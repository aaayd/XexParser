<Window x:Class="XexTool.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:XexTool"
        xmlns:helpers="clr-namespace:XexTool.Helpers"
        xmlns:converters="clr-namespace:XexTool.Converters"
        mc:Ignorable="d"
        Title="XexTool - Xbox 360 Executable Analyzer"
        Height="750" Width="1200"
        MinHeight="600" MinWidth="900"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen"
        AllowDrop="True"
        Drop="Window_Drop"
        DragOver="Window_DragOver">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility"/>
        <converters:ByteArrayToHexConverter x:Key="ByteArrayToHex"/>

        <!-- Storyboards -->
        <Storyboard x:Key="FadeIn">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Key="SlideIn">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                             From="20" To="0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:0.3"/>
        </Storyboard>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource HeaderGradientBrush}" Padding="20,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Logo and Title -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Xbox-style logo -->
                    <Border Width="40" Height="40" CornerRadius="20" Background="{StaticResource PrimaryBrush}" Margin="0,0,12,0">
                        <TextBlock Text="X" FontSize="22" FontWeight="Bold"
                                   Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="XexTool" FontSize="22" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                        <TextBlock Text="Xbox 360 Executable Analyzer" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                </StackPanel>

                <!-- File Path -->
                <Border Grid.Column="1" Margin="30,0" VerticalAlignment="Center">
                    <Grid>
                        <TextBox x:Name="txtFilePath"
                                 Style="{StaticResource ModernTextBoxStyle}"
                                 IsReadOnly="True"
                                 Text="{Binding FilePath, Mode=OneWay}"
                                 VerticalAlignment="Center"/>
                        <TextBlock Text="Drop XEX file here or click Browse..."
                                   Foreground="{StaticResource TextDisabledBrush}"
                                   VerticalAlignment="Center"
                                   Margin="16,0,0,0"
                                   IsHitTestVisible="False"
                                   Visibility="{Binding HasNoFile, Converter={StaticResource BoolToVisibility}}"/>
                    </Grid>
                </Border>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="Browse..."
                            Style="{StaticResource SecondaryButtonStyle}"
                            Click="BrowseButton_Click"
                            Margin="0,0,8,0"
                            ToolTip="Select XEX file to analyze"/>
                    <Button x:Name="btnExtract"
                            Content="Extract PE"
                            Style="{StaticResource PrimaryButtonStyle}"
                            Click="ExtractButton_Click"
                            IsEnabled="{Binding CanExtract}"
                            Margin="0,0,8,0"
                            ToolTip="Extract and decrypt the PE executable"/>
                    <Button x:Name="btnExportImage"
                            Content="Export Image"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Click="ExportImageButton_Click"
                            IsEnabled="{Binding HasImages}"
                            ToolTip="Export embedded images and icons"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="20">
            <!-- Empty State (No File Loaded) -->
            <Border x:Name="emptyState"
                    Visibility="{Binding HasNoFile, Converter={StaticResource BoolToVisibility}}"
                    Style="{StaticResource DropZoneStyle}">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Border Width="80" Height="80" CornerRadius="40" Background="{StaticResource SecondaryLightBrush}" Margin="0,0,0,20">
                        <TextBlock Text="&#x1F4C1;" FontSize="36" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <TextBlock Text="Drop XEX File Here"
                               FontSize="20" FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               HorizontalAlignment="Center" Margin="0,0,0,8"/>
                    <TextBlock Text="or click Browse to select a file"
                               FontSize="13"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               HorizontalAlignment="Center"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
                        <Border Background="{StaticResource SecondaryLightBrush}" CornerRadius="4" Padding="8,4" Margin="4">
                            <TextBlock Text=".xex" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                        </Border>
                        <Border Background="{StaticResource SecondaryLightBrush}" CornerRadius="4" Padding="8,4" Margin="4">
                            <TextBlock Text=".xexp" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                        </Border>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Content Area (File Loaded) -->
            <Grid Visibility="{Binding HasFile, Converter={StaticResource BoolToVisibility}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" MinWidth="300"/>
                    <ColumnDefinition x:Name="colSplitter" Width="0"/>
                    <ColumnDefinition x:Name="colLog" Width="0"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel - File Information -->
                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Game Title Header -->
                        <StackPanel Grid.Row="0" Margin="0,0,0,16">
                            <TextBlock x:Name="lblGameTitle"
                                       Text="{Binding GameTitle, FallbackValue='Unknown Title'}"
                                       Style="{StaticResource TitleLabelStyle}"
                                       TextTrimming="CharacterEllipsis"/>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <Border Background="{StaticResource PrimaryDarkBrush}" CornerRadius="4" Padding="8,4" Margin="0,0,8,0"
                                        Visibility="{Binding HasTitleId, Converter={StaticResource BoolToVisibility}}">
                                    <TextBlock Text="{Binding TitleIdDisplay}" Foreground="{StaticResource PrimaryLightBrush}" FontSize="11" FontWeight="SemiBold"/>
                                </Border>
                                <Border Background="{StaticResource SecondaryLightBrush}" CornerRadius="4" Padding="8,4"
                                        Visibility="{Binding HasMediaId, Converter={StaticResource BoolToVisibility}}">
                                    <TextBlock Text="{Binding MediaIdDisplay}" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                                </Border>
                            </StackPanel>
                        </StackPanel>

                        <!-- Quick Info -->
                        <Border Grid.Row="1" Background="{StaticResource SecondaryDarkBrush}" CornerRadius="6" Padding="12" Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="COMPRESSION" Style="{StaticResource SectionHeaderStyle}"/>
                                    <TextBlock x:Name="lblCompression" Text="{Binding CompressionType, FallbackValue='N/A'}" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="ENCRYPTION" Style="{StaticResource SectionHeaderStyle}"/>
                                    <TextBlock x:Name="lblEncryption" Text="{Binding EncryptionType, FallbackValue='N/A'}" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="IMAGE SIZE" Style="{StaticResource SectionHeaderStyle}"/>
                                    <TextBlock x:Name="lblImageSize" Text="{Binding ImageSizeDisplay, FallbackValue='N/A'}" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Tree View -->
                        <Grid Grid.Row="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="FILE STRUCTURE" Style="{StaticResource SectionHeaderStyle}"/>

                            <Border Grid.Row="1" Background="{StaticResource SecondaryDarkBrush}" CornerRadius="6">
                                <TreeView x:Name="treeInfo"
                                          Style="{StaticResource ModernTreeViewStyle}"
                                          ItemContainerStyle="{StaticResource ModernTreeViewItemStyle}"
                                          Margin="8"
                                          VirtualizingStackPanel.IsVirtualizing="True"
                                          VirtualizingStackPanel.VirtualizationMode="Recycling">
                                    <TreeView.Resources>
                                        <Style TargetType="ScrollBar" BasedOn="{StaticResource ModernScrollBarStyle}"/>
                                    </TreeView.Resources>
                                </TreeView>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Splitter -->
                <GridSplitter x:Name="logSplitter"
                              Grid.Column="1"
                              Width="8"
                              HorizontalAlignment="Stretch"
                              Background="Transparent"
                              Cursor="SizeWE"
                              Visibility="Collapsed"/>

                <!-- Right Panel - Log Console -->
                <Border x:Name="logPanel" Grid.Column="2" Style="{StaticResource CardStyle}" Visibility="Collapsed">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Console Header -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Orientation="Horizontal">
                                <Border Width="8" Height="8" CornerRadius="4" Background="{StaticResource ConsoleAccentBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="PARSE LOG" Style="{StaticResource SectionHeaderStyle}" VerticalAlignment="Center" Margin="0"/>
                            </StackPanel>

                            <Button Grid.Column="1"
                                    Style="{StaticResource IconButtonStyle}"
                                    Click="ClearLogButton_Click"
                                    ToolTip="Clear log">
                                <TextBlock Text="Clear" FontSize="11"/>
                            </Button>
                        </Grid>

                        <!-- Console -->
                        <TextBox x:Name="txtLog"
                                 Grid.Row="1"
                                 Style="{StaticResource ConsoleTextBoxStyle}">
                            <TextBox.Resources>
                                <Style TargetType="ScrollBar" BasedOn="{StaticResource ModernScrollBarStyle}"/>
                            </TextBox.Resources>
                        </TextBox>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="{StaticResource SecondaryDarkBrush}" Padding="16,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock x:Name="lblStatus"
                           Text="{Binding StatusMessage, FallbackValue='Ready'}"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           FontSize="11"
                           VerticalAlignment="Center"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Libraries: " Foreground="{StaticResource TextDisabledBrush}" FontSize="11"/>
                    <TextBlock x:Name="lblLibraryCount" Text="{Binding LibraryCount, FallbackValue='0'}" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" Margin="0,0,16,0"/>
                    <TextBlock Text="Resources: " Foreground="{StaticResource TextDisabledBrush}" FontSize="11"/>
                    <TextBlock x:Name="lblResourceCount" Text="{Binding ResourceCount, FallbackValue='0'}" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" Margin="0,0,16,0"/>

                    <!-- Log Toggle Button -->
                    <Button x:Name="btnToggleLog"
                            Click="ToggleLogButton_Click"
                            Style="{StaticResource IconButtonStyle}"
                            Padding="8,4"
                            ToolTip="Show/Hide Parse Log">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock x:Name="txtLogToggle" Text="Show Log" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Loading Overlay -->
        <Border x:Name="loadingOverlay"
                Grid.RowSpan="3"
                Background="#CC1E1E1E"
                Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border Width="60" Height="60" CornerRadius="30" Background="{StaticResource PrimaryBrush}" Margin="0,0,0,16">
                    <Border.RenderTransform>
                        <RotateTransform x:Name="loadingRotation" Angle="0"/>
                    </Border.RenderTransform>
                    <Border.Triggers>
                        <EventTrigger RoutedEvent="Border.Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever">
                                    <DoubleAnimation Storyboard.TargetName="loadingRotation"
                                                     Storyboard.TargetProperty="Angle"
                                                     From="0" To="360"
                                                     Duration="0:0:1"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </Border.Triggers>
                    <TextBlock Text="&#x21BB;" FontSize="28" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>
                <TextBlock x:Name="lblLoadingText"
                           Text="Processing..."
                           FontSize="14"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
